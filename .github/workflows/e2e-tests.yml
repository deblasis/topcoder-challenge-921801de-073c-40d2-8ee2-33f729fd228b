name: E2E Tests
on: push
jobs:
  run_integration_tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-go@v2
        with:
          go-version: '^1.17.1'  
      - name: Build, run, seed, e2e test
        run: |
          DOCKERCOMPOSE="docker-compose" COMPOSE_DOCKER_CLI_BUILD=1 DOCKER_BUILDKIT=1 make integrationtests-up \
          && make seed-auth_dbsvc \
          && docker ps \
          && sleep 15 \
          && docker ps \
          && sleep 15 \
          && docker ps \
          && curl -X POST http://apigateway:8081/auth/login \
          -H 'Content-Type: application/json' \
          -d '{"username":"deblasis","password":"password1!"}' \
          && DOCKERCOMPOSE="docker-compose" make integrationtests-run
# - name: Seed initial user
#   run: make seed-auth_dbsvc
# - name: E2E Tests
#   run: DOCKERCOMPOSE="docker-compose" make integrationtests-run